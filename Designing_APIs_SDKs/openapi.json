{
    "openapi":"3.1.1",
    "info": {
      "title":"Financial metrics API",
      "version":"1.0"
    },
    "servers": [
      {"url":"https://api.example.com/v1"}
    ],
    "components": {
        "schemas": {
            "Month": {
                "type": "string",
                "title": "Month",
                "description": "Calendar month in YYYY-MM format",
                "pattern": "^\\d{4}-(0[1-9]|1[0-2])$",
                "examples": ["2025-09"]
            },
            "CountryCode": {
                "type": "string",
                "title": "Country Code",
                "description": "ISO 3166-1 alpha-2 country code",
                "pattern": "^[A-Z]{2}$",
                "examples": ["US", "GB", "DE"]
            },
            "PostalCode": {
                "type": "string",
                "title": "Postal Code",
                "description": "Postal/ZIP code",
                "maxLength": 16,
                "pattern": "^[A-Za-z0-9][A-Za-z0-9\\-\\s]{0,14}[A-Za-z0-9]$",
                "examples": ["94105", "SW1A 1AA", "75008"]
            },
            "LastChangedDateTime": {
                "type": "string",
                "title": "Last Changed Data Time",
                "description": "RFC 3339/ISO 8601 timestamp (UTC) to return records last changed on or after this instant.",
                "format": "date-time",
                "examples": ["2025-09-27T14:32:00Z"]
            },
            "LatLon": {
                "type": "string",
                "title": "LatLon",
                "description": "Geographic point expressed as 'latitude,longitude' in decimal degrees.",
                "pattern": "^-?([1-8]?\\d(\\.\\d+)?|90(\\.0+)?),-?(180(\\.0+)?|(1[0-7]\\d)|(\\d?\\d))(\\.\\d+)?$",
                "examples": ["39.0997,-94.5786"]
            },
            "Metric": {
            "type": "object",
            "title": "Metric",
            "description": "Financial and demographic metrics for a given region and time period.",
            "properties": {
                "Month": { "$ref": "#/components/schemas/Month" },
                "CountryCode": { "$ref": "#/components/schemas/CountryCode" },
                "PostalCode": { "$ref": "#/components/schemas/PostalCode" },
                "LatLon": { "$ref": "#/components/schemas/LatLon" },
                "LastChangedDateTime": { "$ref": "#/components/schemas/LastChangedDateTime" },
                "Currency": {
                "type": "string",
                "description": "ISO 4217 currency code in which monetary values are expressed.",
                "pattern": "^[A-Z]{3}$",
                "examples": ["USD", "EUR", "GBP"]
                },
                "Households": {
                "type": "integer",
                "description": "Total number of households in the region.",
                "minimum": 0,
                "examples": [12000]
                },
                "MedianHouseholdIncome": {
                "type": "number",
                "format": "double",
                "description": "Median household income in local currency.",
                "examples": [55000.75]
                },
                "MedianMonthlyRent": {
                "type": "number",
                "format": "double",
                "description": "Median monthly rent in local currency.",
                "examples": [1200.50]
                },
                "VehiclesPerHousehold": {
                "type": "number",
                "format": "double",
                "description": "Average number of vehicles per household.",
                "minimum": 0,
                "examples": [1.8]
                },
                "AverageRetailSpendPerHousehold": {
                "type": "number",
                "format": "double",
                "description": "Average monthly retail spending per household in local currency.",
                "examples": [2300.45]
                }
            },
            "required": [
                "Month",
                "CountryCode",
                "PostalCode",
                "Currency",
                "Households"
            ],
            "additionalProperties": false
            },
            "ProblemDetails": {
                "type": "object",
                "properties": {
                "type": {
                    "type": "string",
                    "format": "uri-reference",
                    "description": "URI reference identifying the problem type."
                },
                "title": {
                    "type": "string",
                    "description": "A short, human-readable summary of the problem type."
                },
                "status": {
                    "type": "integer",
                    "description": "HTTP status code for this error occurrence."
                },
                "detail": {
                    "type": "string",
                    "description": "Explanation specific to this occurrence of the problem."
                },
                "instance": {
                    "type": "string",
                    "format": "uri-reference",
                    "description": "URI reference identifying the specific occurrence of the problem."
                }
                },
                "required": ["title", "status"]
            }
    },
    "responses": {
        "ProblemDetails": {
            "description": "Problem Details using RFC 9457",
            "content": {
                "application/problem+json": {
                    "schema": { "$ref": "#/components/schemas/ProblemDetails" }
                }
            }
        }
    }

    },
    "paths": {
        "/metrics": {
            "get": {
                "description": "Get metrics information",
                "parameters": [
                    {
                        "name": "Month",
                        "in": "query",
                        "required": false,
                        "schema": { "$ref": "#/components/schemas/Month" }
                    },
                    {
                        "name": "CountryCode",
                        "in": "query",
                        "required": false,
                        "schema": { "$ref": "#/components/schemas/CountryCode" }
                    },
                    {
                        "name": "PostalCode",
                        "in": "query",
                        "required": false,
                        "schema": { "$ref": "#/components/schemas/PostalCode" }
                    },
                    {
                        "name": "LastChangedSince",
                        "in": "query",
                        "required": false,
                        "schema": { "$ref": "#/components/schemas/LastChangedDateTime" }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "List of financial metrics",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/Metric"
                                    },
                                    "title": "Response GET metrics"
                                }
                            }
                        }
                    },
                     "422": { "$ref": "#/components/responses/ProblemDetails" },
                     "500": { "$ref": "#/components/responses/ProblemDetails" }
            }
        }
    }
  }
}